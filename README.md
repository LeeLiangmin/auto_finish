# 课程自动完成工具

一个浏览器插件，用于自动完成课程学习：自动点击课程列表，处理视频、PPT和考试。

## 功能特性

- 🎯 **自动遍历课程**：自动点击左侧课程列表，按顺序完成所有课程
- 🎥 **多视频处理**：自动检测并处理页面上的所有视频，逐个快进到结束
- 📄 **多PPT处理**：自动检测并处理页面上的所有PPT，逐个翻页直到完成
- 📝 **智能考试处理**：自动提交考试 → 显示答案 → 根据答案重新选择 → 再次提交，确保满分
- ➡️ **下一讲跳转**：完成当前页面所有内容后，自动检测并点击"下一讲"按钮继续学习
- 📊 **进度显示**：实时显示当前进度和操作状态（如"正在处理视频 2/3"）

## 安装步骤

### 1. 构建项目

```bash
# 安装依赖
bun install

# 构建插件（生产模式）
bun run build

# 或开发模式（不压缩）
bun run build:dev
```

构建完成后，所有文件会输出到 `dist` 目录：
- `popup.js` - 弹窗脚本
- `content.js` - 内容脚本
- `manifest.json` - 插件配置
- `popup.html` - 弹窗界面
- `icon*.png` - 图标文件（自动从 `icons` 目录转换）

### 2. 准备图标文件

插件需要图标文件，请将图标文件放在 `icons` 目录下：

**方式1：使用统一图标**
- 将图标文件命名为 `icon.jpeg` 放在 `icons/` 目录
- 构建时会自动缩放为三个尺寸

**方式2：使用分尺寸图标**
- `icons/icon16.jpeg` (16x16)
- `icons/icon48.jpeg` (48x48)
- `icons/icon128.jpeg` (128x128)

构建脚本会自动将 JPEG 图标转换为 PNG 格式并输出到 `dist` 目录。

### 3. 加载插件到浏览器

#### Chrome/Edge:

1. 打开浏览器，访问 `chrome://extensions/` (Chrome) 或 `edge://extensions/` (Edge)
2. 开启"开发者模式"（右上角开关）
3. 点击"加载已解压的扩展程序"
4. **选择 `dist` 目录**（不是项目根目录）
5. 插件安装完成

## 使用方法

1. 打开课程网站页面
2. 点击浏览器工具栏中的插件图标
3. 在弹窗中点击"开始"按钮
4. 插件将自动：
   - 检测并点击左侧课程列表
   - 根据内容类型（视频/PPT/考试）执行相应操作
   - 显示实时进度
5. 可以随时点击"停止"按钮暂停

## 工作原理

### 内容类型检测

插件通过 DOM 结构智能检测当前页面内容：

- **视频**：检测 `<video>` 元素
- **PPT**：检测包含"下一页"、"next"等文本的按钮
- **考试**：检测包含"提交"、"submit"等文本的按钮

### 自动操作

- **多视频处理**：
  - 自动检测页面上的所有 `<video>` 元素
  - 逐个处理每个视频：将播放进度设置到接近结束（duration - 1秒），等待播放完成
  - 显示处理进度（如"正在处理视频 2/5"）

- **多PPT处理**：
  - 自动检测页面上的所有PPT容器（通过查找"下一页"按钮）
  - 逐个处理每个PPT：循环点击"下一页"按钮，直到按钮禁用或消失
  - 显示处理进度（如"正在翻页PPT 1/3"）

- **智能考试处理**：
  - 自动检测并处理页面上的所有考试
  - 第一步：点击提交按钮提交考试
  - 第二步：检测并点击"显示答案"按钮
  - 第三步：通过多种方式检测答案（高亮标记、class属性、文本标签等）
  - 第四步：根据检测到的答案重新选择所有选项（支持单选、多选、填空）
  - 第五步：再次提交，确保获得满分

- **下一讲跳转**：
  - 完成当前页面所有视频、PPT和考试后
  - 自动检测"下一讲"或"下一章"按钮
  - 如果存在，自动点击并继续处理新页面的内容
  - 循环直到没有"下一讲"按钮为止

### 课程列表检测

插件会查找以下常见的课程列表容器：
- `aside`, `.sidebar`, `.course-list`, `.menu`, `nav`

课程项可能是：
- `li`, `.course-item`, `.lesson-item`, `.tree-node-content`, 或包含 `course`/`lesson` 的链接

## 配置

可以在 `utils.ts` 中的 `defaultConfig` 对象中调整配置：

```typescript
export const defaultConfig: Config = {
  courseListSelector: "aside, .sidebar, .course-list, .menu, nav",
  courseItemSelector: "li, .course-item, .lesson-item, a[href*='course'], a[href*='lesson']",
  waitAfterClick: 1000,        // 点击后等待时间（毫秒）
  waitForContentLoad: 2000,    // 内容加载等待时间（毫秒）
  waitBetweenActions: 500      // 操作间隔时间（毫秒）
};
```

## 开发

### 开发模式

```bash
# 监听文件变化并自动构建
bun run watch
```

### 项目结构

```
.
├── manifest.json       # 插件配置文件
├── popup.html          # 弹窗界面
├── popup.ts            # 弹窗逻辑
├── content.ts           # 内容脚本（注入到页面）
├── types.ts            # TypeScript 类型定义
├── utils.ts            # 工具函数
└── package.json        # 项目配置
```

## 注意事项

1. **网站兼容性**：插件使用通用的 DOM 选择器，可能无法适配所有网站。如果遇到问题，可以调整 `utils.ts` 中的选择器配置。

2. **视频完成检测**：某些网站可能需要视频播放到 100% 才会标记为完成。如果遇到问题，可以调整 `content.ts` 中的视频处理逻辑。

3. **权限**：插件需要访问所有网站（`<all_urls>`）和存储权限，这是正常的功能需求。

4. **浏览器警告**：如果看到 "non-passive event listener" 相关的警告，这通常来自网站本身的代码，不是插件的问题，可以安全忽略。

5. **使用建议**：建议在测试环境中先试用，确认功能正常后再用于正式课程。

## 许可证

MIT
